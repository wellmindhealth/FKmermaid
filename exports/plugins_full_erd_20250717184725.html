<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Plugins Full ER Diagram - Mermaid Live Editor</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0;
            padding: 0;
            height: 100vh;
            background: #f5f5f5;
        }
        .left-panel {
            width: 15%;
            min-width: 250px;
            padding: 12px;
            background: white;
            font-size: 12px;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            overflow-y: auto;
        }
        .code-block {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #ddd;
            font-family: monospace;
            white-space: pre-wrap;
            margin: 8px 0;
            font-size: 12px;
            max-height: 60vh;
            overflow-y: auto;
            width: 100%;
            box-sizing: border-box;
            cursor: text;
            user-select: text;
        }
        .code-block:hover {
            border-color: #2196F3;
        }
        .button {
            background: #2196F3;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin: 4px 0;
            white-space: nowrap;
            width: 100%;
            text-align: center;
            text-decoration: none;
            display: block;
            box-sizing: border-box;
        }
        .button:hover {
            background: #1976D2;
        }
        .success-message {
            display: none;
            color: #4CAF50;
            margin: 4px 0;
            font-size: 12px;
            padding: 4px;
            background: #E8F5E9;
            border-radius: 4px;
            text-align: center;
        }
        .error-message {
            display: none;
            color: #FF9800;
            margin: 4px 0;
            font-size: 12px;
            padding: 4px;
            background: #FFF3E0;
            border-radius: 4px;
            text-align: center;
        }
        h1 { 
            margin: 0 0 8px 0; 
            font-size: 1.4em;
            font-weight: bold;
        }
        h2 {
            margin: 8px 0;
            font-size: 1.1em;
            font-weight: normal;
        }
        h3 {
            margin: 8px 0;
            font-size: 1em;
        }
        h4 {
            margin: 8px 0;
            font-size: 0.9em;
            font-weight: bold;
        }
        .instructions {
            background: #e3f2fd;
            padding: 8px;
            border-radius: 4px;
            margin: 8px 0;
            font-size: 12px;
        }
        #paste-reminder {
            display: none;
            position: fixed;
            top: 20px;
            right: 20px;
            background: #E3F2FD;
            padding: 12px;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            z-index: 1000;
            font-size: 14px;
            animation: fadeInOut 5s forwards;
        }
        @keyframes fadeInOut {
            0% { opacity: 0; }
            10% { opacity: 1; }
            80% { opacity: 1; }
            100% { opacity: 0; }
        }
    </style>
</head>
<body>
    <div class="left-panel">
        <h1>Plugins Full ER</h1>
        <h2>Complete plugins ER diagram with all relationships</h2>
        <h3>ER Diagram</h3>
        <div class="instructions">
            <h4>Quick Steps</h4>
            <ol>
                <li>Click "Open Editor & Copy"</li>
                <li>Wait for editor to load</li>
                <li>Press Ctrl+V to paste</li>
            </ol>
        </div>
        <button class="button" onclick="openEditorAndCopy()">Open Editor & Copy</button>
        <div id="copySuccess" class="success-message">‚úì Code copied! Press Ctrl+V to paste</div>
        <div id="copyError" class="error-message">Failed to copy code. Please select and copy manually.</div>
        <button class="button" onclick="manualCopy()" style="background: #FF9800; margin-top: 8px;">üìã Manual Copy Only</button>
        <button class="button" onclick="showDebugInfo()" style="background: #9C27B0; margin-top: 4px;">üêõ Debug Info</button>
        <div class="code-block" id="mermaidSource">erDiagram
    "api_apiAccessKey" {
        UUID ObjectID
        string title
        string bActive
        string accessKeyID
    }

    "microsoftud_mudGroup" {
        UUID ObjectID
        string Microsoft_UD_Group
        array aDomains
        string MUDappRoleId
    }

    "microsoftud_mudUser" {
        UUID ObjectID
        string Microsoft_UD_User
        string lGroups
        string refreshToken
    }

    "pathway_activity" {
        UUID ObjectID
        string Activity_Instance
        string activityDefID
        datetime bComplete
    }

    "pathway_activityDef" {
        UUID ObjectID
        string Farcry_Activity_Definition
        string title
        string stepNum
    }

    "pathway_address" {
        UUID ObjectID
        string Addresses
        string dmProfileID
        string FirstName
    }

    "pathway_center" {
        UUID ObjectID
        string Center
        string center
        string dmProfileID
    }

    "pathway_guide" {
        UUID ObjectID
        string Guide
        string guide
        string centerID
    }

    "pathway_intake" {
        UUID ObjectID
        string Intake
        string centerID
        string pipeOrgID
    }

    "pathway_journalDef" {
        UUID ObjectID
        string Journal_Definition
        string tracker02Title
        string programmeID
    }

    "pathway_media" {
        UUID ObjectID
        string Media
        string partnerID
        string programmeID
    }

    "pathway_member" {
        UUID ObjectID
        string Member
        string memberGroupID
        string member
    }

    "pathway_memberGroup" {
        UUID ObjectID
        string Member_Group
        string UtmSourceID
        string bDefault
    }

    "pathway_memberType" {
        UUID ObjectID
        string MemberType
        boolean bNavTools
        boolean bSimpleNavTools
    }

    "pathway_module" {
        UUID ObjectID
        string Farcry_Module_Instance
        string title
        string completionDate
    }

    "pathway_moduleDef" {
        UUID ObjectID
        string Farcry_Activity_Definition
        string lTypenames
        string currPos
    }

    "pathway_orderItem" {
        UUID ObjectID
        UUID Order_Item
        string quantity
        string autoSetLabel
    }

    "pathway_orderMaster" {
        UUID ObjectID
        string Order
        string aOrderItemIDs
        string braintreeNonce
    }

    "pathway_partner" {
        UUID ObjectID
        string Partner
        string partner
        string seniorSupportID
    }

    "pathway_progMember" {
        UUID ObjectID
        string Program_Member
        string memberID
        string DOW
    }

    "pathway_programme" {
        UUID ObjectID
        string Programme
        string Title
        string programme
    }

    "pathway_progRole" {
        UUID ObjectID
        string ProgRole
        string description
        UUID programmeID
    }

    "pathway_referer" {
        UUID ObjectID
        string Referrer
        string guide
        string partnerID
    }

    "pathway_report" {
        UUID ObjectID
        string Report
        string partnerID
        string memberID
    }

    "pathway_shopItem" {
        UUID ObjectID
        string Shop_Item
        UUID teaserImage
        string Teaser
    }

    "pathway_testimonial" {
        UUID ObjectID
        string Testimonial_Instance
        string activityDefID
        string title
    }

    "pathway_trackerDef" {
        UUID ObjectID
        string Tracker_Definition
        string description
        boolean bOptional
    }

    "social_dmProfile" {
        UUID ObjectID
        string facebookID
        string linkedinID
    }

    "pathway_member" {
        UUID ObjectID
        string Member
        string memberGroupID
        string member
    }

    %% Direct FK Relationships
    "microsoftud_mudUser" ||--|| "microsoftud_mudGroup" : lGroups
    "pathway_activity" ||--|| "pathway_progMember" : Activity Instance
    "pathway_activity" ||--|| "pathway_activityDef" : activityDefID
    "pathway_activityDef" ||--|| "pathway_programme" : Farcry Activity Definition
    "pathway_activityDef" ||--|| "pathway_guide" : stepNum
    "pathway_activityDef" ||--|| "pathway_progRole" : role
    "pathway_activityDef" ||--|| "pathway_activityDef" : onEndID
    "pathway_activityDef" ||--|| "pathway_media" : description
    "pathway_activityDef" ||--|| "pathway_activityDef" : aCuePointActivities
    "pathway_activityDef" ||--|| "pathway_media" : aMediaIDs
    "pathway_activityDef" ||--|| "pathway_activityDef" : releaseMedia
    "pathway_activityDef" ||--|| "pathway_activityDef" : includeFieldsInteract1
    "pathway_activityDef" ||--|| "pathway_activityDef" : includeFieldsInteract2
    "pathway_activityDef" ||--|| "pathway_activityDef" : includeFieldsInteract3
    "pathway_activityDef" ||--|| "pathway_activityDef" : includeFieldsInteract4
    "pathway_activityDef" ||--|| "pathway_journalDef" : includeFieldsInteract5
    "pathway_activityDef" ||--|| "pathway_trackerDef" : jReviewHTML
    "pathway_activityDef" ||--|| "pathway_trackerDef" : tracker02ID
    "pathway_activityDef" ||--|| "pathway_trackerDef" : tracker03ID
    "pathway_activityDef" ||--|| "pathway_trackerDef" : tracker04ID
    "pathway_activityDef" ||--|| "pathway_trackerDef" : tracker05ID
    "pathway_address" ||--|| "pathway_member" : Addresses
    "pathway_address" ||--|| "social_dmProfile" : dmProfileID
    "pathway_center" ||--|| "social_dmProfile" : center
    "pathway_center" ||--|| "social_dmProfile" : dmProfileID
    "pathway_center" ||--|| "pathway_partner" : partnerID
    "pathway_center" ||--|| "pathway_memberGroup" : memberGroupID
    "pathway_center" ||--|| "pathway_referer" : aReferers
    "pathway_guide" ||--|| "pathway_partner" : guide
    "pathway_guide" ||--|| "pathway_center" : centerID
    "pathway_intake" ||--|| "pathway_memberGroup" : Intake
    "pathway_intake" ||--|| "pathway_center" : centerID
    "pathway_intake" ||--|| "pathway_member" : pipeOrgID
    "pathway_journalDef" ||--|| "pathway_trackerDef" : Journal Definition
    "pathway_journalDef" ||--|| "pathway_trackerDef" : tracker02Title
    "pathway_journalDef" ||--|| "pathway_programme" : programmeID
    "pathway_media" ||--|| "pathway_guide" : Media
    "pathway_media" ||--|| "pathway_partner" : partnerID
    "pathway_media" ||--|| "pathway_programme" : programmeID
    "pathway_media" ||--|| "pathway_progRole" : roleID
    "pathway_member" ||--|| "pathway_memberType" : Member
    "pathway_member" ||--|| "pathway_memberGroup" : memberGroupID
    "pathway_member" ||--|| "pathway_partner" : member
    "pathway_member" ||--|| "pathway_center" : member
    "pathway_member" ||--|| "pathway_referer" : member
    "pathway_member" ||--|| "pathway_orderMaster" : member
    "pathway_member" ||--|| "pathway_address" : aAddresses
    "pathway_member" ||--|| "pathway_activityDef" : ssoID
    "pathway_member" ||--|| "pathway_progRole" : caseness
    "pathway_module" ||--|| "pathway_moduleDef" : completionDate
    "pathway_module" ||--|| "pathway_member" : referenceID
    "pathway_module" ||--|| "pathway_module" : currPos
    "pathway_module" ||--|| "pathway_activity" : currActivityDefID
    "pathway_moduleDef" ||--|| "pathway_activityDef" : Farcry Activity Definition
    "pathway_moduleDef" ||--|| "pathway_member" : lTypenames
    "pathway_moduleDef" ||--|| "pathway_module" : currPos
    "pathway_moduleDef" ||--|| "pathway_activity" : currActivityDefID
    "pathway_orderMaster" ||--|| "pathway_shopItem" : Order
    "pathway_partner" ||--|| "social_dmProfile" : partner
    "pathway_partner" ||--|| "social_dmProfile" : seniorSupportID
    "pathway_partner" ||--|| "pathway_center" : aCenters
    "pathway_partner" ||--|| "pathway_referer" : aReferers
    "pathway_progMember" ||--|| "pathway_programme" : Program Member
    "pathway_progMember" ||--|| "pathway_member" : memberID
    "pathway_progMember" ||--|| "pathway_activity" : DOW
    "pathway_programme" ||--|| "pathway_partner" : Programme
    "pathway_programme" ||--|| "pathway_activityDef" : programme
    "pathway_programme" ||--|| "pathway_activityDef" : lastActivityDefID
    "pathway_programme" ||--|| "pathway_activityDef" : lSSQpoints
    "pathway_programme" ||--|| "pathway_trackerDef" : aTrackerIDs
    "pathway_progRole" ||--|| "pathway_programme" : ProgRole
    "pathway_referer" ||--|| "social_dmProfile" : guide
    "pathway_referer" ||--|| "pathway_partner" : partnerID
    "pathway_referer" ||--|| "pathway_memberGroup" : memberGroupID
    "pathway_referer" ||--|| "pathway_center" : centerID
    "pathway_report" ||--|| "pathway_programme" : Report
    "pathway_report" ||--|| "pathway_partner" : partnerID
    "pathway_report" ||--|| "pathway_member" : memberID
    "pathway_report" ||--|| "pathway_memberType" : memberTypeID
    "pathway_report" ||--|| "pathway_memberGroup" : aMemberGroupID
    "pathway_shopItem" ||--|| "pathway_shopItem" : Shop Item
    "pathway_testimonial" ||--|| "pathway_member" : Testimonial Instance
    "pathway_testimonial" ||--|| "pathway_activityDef" : activityDefID
    "pathway_trackerDef" ||--|| "pathway_programme" : Tracker Definition

    %% Join Table Relationships

    %% Entity Styling
    style api_apiAccessKey fill:#9e9e9e,stroke:#fff,stroke-width:1px,color:#fff
    style microsoftud_mudGroup fill:#42a5f5,stroke:#fff,stroke-width:2px,color:#fff
    style microsoftud_mudUser fill:#42a5f5,stroke:#fff,stroke-width:2px,color:#fff
    style pathway_activity fill:#1976d2,stroke:#fff,stroke-width:4px,color:#fff
    style pathway_activityDef fill:#1976d2,stroke:#fff,stroke-width:4px,color:#fff
    style pathway_address fill:#9e9e9e,stroke:#fff,stroke-width:1px,color:#fff
    style pathway_center fill:#9e9e9e,stroke:#fff,stroke-width:1px,color:#fff
    style pathway_guide fill:#9e9e9e,stroke:#fff,stroke-width:1px,color:#fff
    style pathway_intake fill:#9e9e9e,stroke:#fff,stroke-width:1px,color:#fff
    style pathway_journalDef fill:#43a047,stroke:#fff,stroke-width:4px,color:#fff
    style pathway_media fill:#9e9e9e,stroke:#fff,stroke-width:1px,color:#fff
    style pathway_member fill:#1976d2,stroke:#fff,stroke-width:4px,color:#fff
    style pathway_memberGroup fill:#9e9e9e,stroke:#fff,stroke-width:1px,color:#fff
    style pathway_memberType fill:#9e9e9e,stroke:#fff,stroke-width:1px,color:#fff
    style pathway_module fill:#388e3c,stroke:#fff,stroke-width:3px,color:#fff
    style pathway_moduleDef fill:#388e3c,stroke:#fff,stroke-width:3px,color:#fff
    style pathway_orderItem fill:#9e9e9e,stroke:#fff,stroke-width:1px,color:#fff
    style pathway_orderMaster fill:#9e9e9e,stroke:#fff,stroke-width:1px,color:#fff
    style pathway_partner fill:#9e9e9e,stroke:#fff,stroke-width:1px,color:#fff
    style pathway_progMember fill:#1976d2,stroke:#fff,stroke-width:4px,color:#fff
    style pathway_programme fill:#1976d2,stroke:#fff,stroke-width:4px,color:#fff
    style pathway_progRole fill:#1976d2,stroke:#fff,stroke-width:4px,color:#fff
    style pathway_referer fill:#9e9e9e,stroke:#fff,stroke-width:1px,color:#fff
    style pathway_report fill:#388e3c,stroke:#fff,stroke-width:3px,color:#fff
    style pathway_shopItem fill:#9e9e9e,stroke:#fff,stroke-width:1px,color:#fff
    style pathway_testimonial fill:#9e9e9e,stroke:#fff,stroke-width:1px,color:#fff
    style pathway_trackerDef fill:#43a047,stroke:#fff,stroke-width:4px,color:#fff
    style social_dmProfile fill:#42a5f5,stroke:#fff,stroke-width:2px,color:#fff
    style farcrypathwaymeditainment_member fill:#1976d2,stroke:#fff,stroke-width:4px,color:#fff
</div>
    </div>

    <div id="paste-reminder">
        Press Ctrl+V to paste your diagram code!
    </div>

    <script>
    function showPasteReminder() {
        const reminder = document.getElementById('paste-reminder');
        reminder.style.display = 'block';
        setTimeout(() => {
            reminder.style.display = 'none';
        }, 5000);
    }

    function openEditorAndCopy() {
        // Get the code from the div instead of using a template string
        const mermaidContent = document.getElementById('mermaidSource').textContent;
        
        console.log('Attempting to copy:', mermaidContent.substring(0, 100) + '...');
        console.log('Full content length:', mermaidContent.length);
        
        // Try modern clipboard API first
        if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(mermaidContent).then(() => {
                console.log('Clipboard API success');
                // Show success message
                const msg = document.getElementById('copySuccess');
                msg.style.display = 'block';
                setTimeout(() => msg.style.display = 'none', 3000);
                
                // Open Mermaid Live Editor in new tab
                window.open('https://mermaid.live/edit', '_blank');
                
                // Show paste reminder
                showPasteReminder();
            }).catch(err => {
                console.error('Clipboard API failed:', err);
                showCopyError();
            });
        } else {
            console.log('Using fallback copy method');
            fallbackCopy();
        }
        
        function fallbackCopy() {
            try {
                const textArea = document.createElement('textarea');
                textArea.value = mermaidContent;
                textArea.style.position = 'fixed';
                textArea.style.left = '-999999px';
                textArea.style.top = '-999999px';
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                const successful = document.execCommand('copy');
                document.body.removeChild(textArea);
                
                if (successful) {
                    console.log('execCommand success');
                    const msg = document.getElementById('copySuccess');
                    msg.style.display = 'block';
                    msg.textContent = '‚úì Code copied! Press Ctrl+V to paste';
                    setTimeout(() => msg.style.display = 'none', 3000);
                    
                    // Open editor with URL parameters
                    const editorUrl = 'https://mermaid.live/edit';
                    
                    // Open Mermaid Live Editor in new tab
                    window.open(editorUrl, '_blank');
                    
                    setTimeout(showPasteReminder, 1000);
                } else {
                    console.log('execCommand failed');
                    showCopyError();
                }
            } catch (err) {
                console.error('execCommand error:', err);
                showCopyError();
            }
        }

        function showCopyError() {
            const msg = document.getElementById('copyError');
            msg.style.display = 'block';
            setTimeout(() => msg.style.display = 'none', 5000);
        }
    }

    function manualCopy() {
        const mermaidContent = document.getElementById('mermaidSource').textContent;
        if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(mermaidContent).then(() => {
                const msg = document.getElementById('copySuccess');
                msg.style.display = 'block';
                msg.textContent = '‚úì Code copied! Press Ctrl+V to paste';
                setTimeout(() => msg.style.display = 'none', 3000);
                console.log('Manual copy successful via Clipboard API');
            }).catch(err => {
                const msg = document.getElementById('copyError');
                msg.style.display = 'block';
                msg.textContent = 'Failed to copy code. Please select and copy manually.';
                setTimeout(() => msg.style.display = 'none', 5000);
                console.error('Manual copy failed via Clipboard API:', err);
            });
        } else {
            try {
                const textArea = document.createElement('textarea');
                textArea.value = mermaidContent;
                textArea.style.position = 'fixed';
                textArea.style.left = '-999999px';
                textArea.style.top = '-999999px';
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                const successful = document.execCommand('copy');
                document.body.removeChild(textArea);
                if (successful) {
                    const msg = document.getElementById('copySuccess');
                    msg.style.display = 'block';
                    msg.textContent = '‚úì Code copied! Press Ctrl+V to paste';
                    setTimeout(() => msg.style.display = 'none', 3000);
                    console.log('Manual copy successful via execCommand');
                } else {
                    const msg = document.getElementById('copyError');
                    msg.style.display = 'block';
                    msg.textContent = 'Failed to copy code. Please select and copy manually.';
                    setTimeout(() => msg.style.display = 'none', 5000);
                    console.log('Manual copy failed via execCommand');
                }
            } catch (err) {
                const msg = document.getElementById('copyError');
                msg.style.display = 'block';
                msg.textContent = 'Failed to copy code. Please select and copy manually.';
                setTimeout(() => msg.style.display = 'none', 5000);
                console.error('Manual copy failed via execCommand:', err);
            }
        }
    }

    function showDebugInfo() {
        const mermaidContent = document.getElementById('mermaidSource').textContent;
        console.log('=== DEBUG INFO ===');
        console.log('Content length:', mermaidContent.length);
        console.log('First 200 chars:', mermaidContent.substring(0, 200));
        console.log('Last 100 chars:', mermaidContent.substring(mermaidContent.length - 100));
        console.log('Contains "erDiagram":', mermaidContent.includes('erDiagram'));
        console.log('Contains "classDiagram":', mermaidContent.includes('classDiagram'));
        console.log('Full content:');
        console.log(mermaidContent);
        
        // Show in an alert for easy viewing
        alert('Content length: ' + mermaidContent.length + '\n\nFirst 200 chars:\n' + mermaidContent.substring(0, 200) + '\n\nContains erDiagram: ' + mermaidContent.includes('erDiagram'));
    }
    </script>
</body>
</html>
