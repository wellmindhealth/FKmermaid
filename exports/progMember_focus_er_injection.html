<!DOCTYPE html>
<html>
<head>
    <title>progMember ER Diagram - Mermaid Live Editor</title>
    <style>
        body { margin: 0; padding: 0; font-family: Arial, sans-serif; }
        .container { display: flex; height: 100vh; }
        .sidebar { width: 300px; background: #f5f5f5; padding: 20px; overflow-y: auto; }
        .editor { flex: 1; }
        iframe { width: 100%; height: 100%; border: none; }
        .button { background: #2196F3; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px; display: inline-block; margin: 10px 5px; }
        .success { color: #4CAF50; font-weight: bold; }
        .code { background: #f0f0f0; padding: 10px; border-radius: 5px; font-family: monospace; white-space: pre-wrap; font-size: 12px; max-height: 200px; overflow-y: auto; }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <h2>progMember ER Diagram</h2>
            <p class="success">Loading Mermaid Live Editor...</p>
            
            <div id="status">
                <p>Attempting to inject content into Mermaid Live Editor...</p>
            </div>
            
            <div id="manual">
                <h3>Manual Method (if auto-injection fails)</h3>
                <p>1. Click the button below to copy the diagram code</p>
                <p>2. Paste into the editor (Ctrl+V)</p>
                <button id="copyButton" onclick="copyDiagramToClipboard()" style="background: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin-bottom: 10px;">üìã Copy Diagram Code</button>
                <div id="copyStatus" style="margin-bottom: 10px;"></div>
                <div class="code">erDiagram
    progMember {
        string id
        string name
    }
    activity {
        string id
        string name
    }
    activityDef {
        string id
        string name
    }
    guide {
        string id
        string name
    }
    journal {
        string id
        string name
    }
    media {
        string id
        string name
    }
    member {
        string id
        string name
    }
    memberGroup {
        string id
        string name
    }
    programme {
        string id
        string name
    }
    progRole {
        string id
        string name
    }
    tracker {
        string id
        string name
    }
    tracker01 {
        string id
        string name
    }
    tracker02 {
        string id
        string name
    }
    tracker03 {
        string id
        string name
    }
    tracker04 {
        string id
        string name
    }
    tracker05 {
        string id
        string name
    }

    %% Relationships
    progMember ||--o{ activity : "related to"
    progMember ||--o{ activityDef : "related to"
    progMember ||--o{ guide : "related to"
    progMember ||--o{ journal : "related to"
    progMember ||--o{ media : "related to"
    progMember ||--o{ member : "related to"
    progMember ||--o{ memberGroup : "related to"
    progMember ||--o{ programme : "related to"
    progMember ||--o{ progRole : "related to"
    progMember ||--o{ tracker : "related to"
    progMember ||--o{ tracker01 : "related to"
    progMember ||--o{ tracker02 : "related to"
    progMember ||--o{ tracker03 : "related to"
    progMember ||--o{ tracker04 : "related to"
    progMember ||--o{ tracker05 : "related to"</div>
            </div>
            
            <div style="margin-top: 20px;">
                <a href="https://mermaid.live/edit" target="_blank" class="button">Open Mermaid Live Editor</a>
                <a href="D:\GIT\farcry\Cursor\FKmermaid\exports\progMember_focus_er_simple.html" target="_blank" class="button">View Simple HTML</a>
            </div>
        </div>
        
        <div class="editor">
            <iframe id="mermaidEditor" src="https://mermaid.live/edit"></iframe>
        </div>
    </div>
    
    <script>
        const mermaidContent = $mermaidContentForHtml;
        const iframe = document.getElementById('mermaidEditor');
        const status = document.getElementById('status');
        
        // Wait for iframe to load
        iframe.onload = function() {
            try {
                // Try to inject content into the iframe
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                
                // Look for the code editor
                const codeEditor = iframeDoc.querySelector('textarea, .monaco-editor, #editor');
                if (codeEditor) {
                    codeEditor.value = mermaidContent;
                    codeEditor.dispatchEvent(new Event('input', { bubbles: true }));
                    status.innerHTML = '<p class="success">Content injected successfully!</p>';
                } else {
                    status.innerHTML = '<p>Could not find editor. Please use manual method.</p>';
                }
            } catch (error) {
                status.innerHTML = '<p>Cross-origin restriction. Please use manual method.</p>';
            }
        };
        
        // Copy to clipboard as backup
        if (navigator.clipboard) {
            navigator.clipboard.writeText(mermaidContent);
        }

        function copyDiagramToClipboard() {
            console.log('Copy button clicked');
            
            // Get the diagram code from the visible div instead of template string
            const diagramCodeDiv = document.querySelector('.code');
            const diagramCode = diagramCodeDiv ? diagramCodeDiv.textContent : '';
            
            console.log('Diagram code length:', diagramCode.length);
            console.log('First 100 chars:', diagramCode.substring(0, 100));
            
            const copyStatusDiv = document.getElementById('copyStatus');
            
            if (!diagramCode) {
                copyStatusDiv.textContent = '‚ùå No diagram code found!';
                copyStatusDiv.style.color = '#FF9800';
                copyStatusDiv.style.fontWeight = 'bold';
                return;
            }
            
            // Try modern clipboard API first
            if (navigator.clipboard && navigator.clipboard.writeText) {
                console.log('Using modern clipboard API');
                navigator.clipboard.writeText(diagramCode).then(() => {
                    console.log('Clipboard API success');
                    copyStatusDiv.textContent = '‚úÖ Diagram code copied to clipboard!';
                    copyStatusDiv.style.color = '#4CAF50';
                    copyStatusDiv.style.fontWeight = 'bold';
                }).catch(err => {
                    console.error('Clipboard API failed:', err);
                    // Fallback to execCommand
                    fallbackCopy();
                });
            } else {
                console.log('Using fallback copy method');
                // Fallback for older browsers
                fallbackCopy();
            }
            
            function fallbackCopy() {
                try {
                    console.log('Using execCommand fallback');
                    const textArea = document.createElement('textarea');
                    textArea.value = diagramCode;
                    textArea.style.position = 'fixed';
                    textArea.style.left = '-999999px';
                    textArea.style.top = '-999999px';
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    const successful = document.execCommand('copy');
                    document.body.removeChild(textArea);
                    
                    if (successful) {
                        console.log('execCommand success');
                        copyStatusDiv.textContent = '‚úÖ Diagram code copied to clipboard!';
                        copyStatusDiv.style.color = '#4CAF50';
                        copyStatusDiv.style.fontWeight = 'bold';
                    } else {
                        console.log('execCommand failed');
                        copyStatusDiv.textContent = '‚ùå Failed to copy. Please select and copy manually.';
                        copyStatusDiv.style.color = '#FF9800';
                        copyStatusDiv.style.fontWeight = 'bold';
                    }
                } catch (err) {
                    console.error('execCommand error:', err);
                    copyStatusDiv.textContent = '‚ùå Failed to copy. Please select and copy manually.';
                    copyStatusDiv.style.color = '#FF9800';
                    copyStatusDiv.style.fontWeight = 'bold';
                }
            }
        }
    </script>
</body>
</html>
