<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>progMember ER Diagram - Mermaid Live Editor</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0;
            padding: 0;
            height: 100vh;
            background: #f5f5f5;
        }
        .left-panel {
            width: 15%;
            min-width: 250px;
            padding: 12px;
            background: white;
            font-size: 12px;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            overflow-y: auto;
        }
        .code-block {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #ddd;
            font-family: monospace;
            white-space: pre-wrap;
            margin: 8px 0;
            font-size: 12px;
            max-height: 60vh;
            overflow-y: auto;
            width: 100%;
            box-sizing: border-box;
            cursor: text;
            user-select: text;
        }
        .code-block:hover {
            border-color: #2196F3;
        }
        .button {
            background: #2196F3;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin: 4px 0;
            white-space: nowrap;
            width: 100%;
            text-align: center;
            text-decoration: none;
            display: block;
            box-sizing: border-box;
        }
        .button:hover {
            background: #1976D2;
        }
        .success-message {
            display: none;
            color: #4CAF50;
            margin: 4px 0;
            font-size: 12px;
            padding: 4px;
            background: #E8F5E9;
            border-radius: 4px;
            text-align: center;
        }
        .error-message {
            display: none;
            color: #FF9800;
            margin: 4px 0;
            font-size: 12px;
            padding: 4px;
            background: #FFF3E0;
            border-radius: 4px;
            text-align: center;
        }
        h1 { 
            margin: 0 0 8px 0; 
            font-size: 1.4em;
            font-weight: bold;
        }
        h2 {
            margin: 8px 0;
            font-size: 1.1em;
            font-weight: normal;
        }
        h3 {
            margin: 8px 0;
            font-size: 1em;
        }
        h4 {
            margin: 8px 0;
            font-size: 0.9em;
            font-weight: bold;
        }
        .instructions {
            background: #e3f2fd;
            padding: 8px;
            border-radius: 4px;
            margin: 8px 0;
            font-size: 12px;
        }
        #paste-reminder {
            display: none;
            position: fixed;
            top: 20px;
            right: 20px;
            background: #E3F2FD;
            padding: 12px;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            z-index: 1000;
            font-size: 14px;
            animation: fadeInOut 5s forwards;
        }
        @keyframes fadeInOut {
            0% { opacity: 0; }
            10% { opacity: 1; }
            80% { opacity: 1; }
            100% { opacity: 0; }
        }
    </style>
</head>
<body>
    <div class="left-panel">
        <h1>progMember</h1>
        <h2>progMember | partner, participant, programme, site 'focus'</h2>
        <h3>ER Diagram</h3>
        <div class="instructions">
            <h4>Quick Steps</h4>
            <ol>
                <li>Click "Open Editor & Copy"</li>
                <li>Wait for editor to load</li>
                <li>Press Ctrl+V to paste</li>
            </ol>
        </div>
        <button class="button" onclick="openEditorAndCopy()">Open Editor & Copy</button>
        <div id="copySuccess" class="success-message">‚úì Code copied! Press Ctrl+V to paste</div>
        <div id="copyError" class="error-message">Failed to copy code. Please select and copy manually.</div>
        <button class="button" onclick="manualCopy()" style="background: #FF9800; margin-top: 8px;">üìã Manual Copy Only</button>
        <button class="button" onclick="showDebugInfo()" style="background: #9C27B0; margin-top: 4px;">üêõ Debug Info</button>
        <div class="code-block" id="mermaidSource">graph TB
    %% Beautiful distributed layout with proper clustering
    %% Focus entity with distributed arrangement
    %% Layout: distributed arrangement with proper clustering
    subgraph Core
        direction TB
        progMember {
            objectID UUID
        }
        activityDef {
            objectID UUID
        }
        center {
            objectID UUID
        }
        intake {
            objectID UUID
        }
        media {
            objectID UUID
        }
        memberGroup {
            objectID UUID
        }
        partner {
            objectID UUID
        }
        programme {
            objectID UUID
        }
        progRole {
            objectID UUID
        }
        referer {
            objectID UUID
        }
        aCuePointActivities {
            objectID UUID
        }
        aMediaIDs {
            objectID UUID
        }
        defaultMediaID {
            objectID UUID
        }
        dmFacts {
            objectID UUID
        }
        dmFile {
            objectID UUID
        }
        dmHTML {
            objectID UUID
        }
        dmImage {
            objectID UUID
        }
        dmInclude {
            objectID UUID
        }
        dmNavigation {
            objectID UUID
        }
        dmNews {
            objectID UUID
        }
        guide {
            objectID UUID
        }
        member {
            objectID UUID
        }
    end

    subgraph Tracker
        direction TB
        journal {
            objectID UUID
        }
        tracker {
            objectID UUID
        }
        tracker01 {
            objectID UUID
        }
        tracker02 {
            objectID UUID
        }
        tracker03 {
            objectID UUID
        }
        tracker04 {
            objectID UUID
        }
        tracker05 {
            objectID UUID
        }
    end

    subgraph SSQ
        direction TB
        SSQ_arthritis01 {
            objectID UUID
        }
        SSQ_pain01 {
            objectID UUID
        }
        SSQ_stress01 {
            objectID UUID
        }
    end

    subgraph Interact
        direction TB
        aCuePointActivities
        aInteract1Activities
        aInteract2Activities
        aInteract3Activities
        aInteract4Activities
        aInteract5Activities
        onEndID
    end

    subgraph Other
        direction TB
        dmProfile
        farGroup
        farPermission
        farRole
        farUser
        activity
        address
        device
        journalDef
        JWTapp
        library
        memberType
        oAuth2service
        promotion
        report
        token
        trackerDef
    end


    %% Sophisticated relationships with proper labels and cardinality
    %% Core Relationships %%
    progMember --> activityDef
    progMember --> center
    progMember --> media
    progMember --> partner
    progMember --> programme
    progMember --> activity
    progMember --> aMediaIDs
    progMember --> defaultMediaID
    progMember --> dmFile
    progMember --> guide
    progMember --> journalDef
    progMember --> report

    %% Tracker Relationships %%
    progMember --> trackerDef

    %% Interact Relationships %%
    progMember --> aInteract1Activities
    progMember --> aInteract2Activities
    progMember --> aInteract3Activities
    progMember --> aInteract4Activities
    progMember --> aInteract5Activities

    %% SSQ Relationships %%
    progMember --> SSQ_arthritis01
    progMember --> SSQ_pain01
    progMember --> SSQ_stress01

    %% Member Relationships %%
    progMember --> memberGroup
    progMember --> member
    progMember --> memberType

    %% Other Relationships %%
    progMember --> dmProfile
    progMember --> farGroup
    progMember --> farPermission
    progMember --> farRole
    progMember --> farUser
    progMember --> intake
    progMember --> progRole
    progMember --> referer
    progMember --> aCuePointActivities
    progMember --> dmFacts
    progMember --> dmHTML
    progMember --> dmImage
    progMember --> dmInclude
    progMember --> dmNavigation
    progMember --> dmNews
    progMember --> journal
    progMember --> onEndID
    progMember --> tracker
    progMember --> tracker01
    progMember --> tracker02
    progMember --> tracker03
    progMember --> tracker04
    progMember --> tracker05
    progMember --> address
    progMember --> device
    progMember --> JWTapp
    progMember --> library
    progMember --> oAuth2service
    progMember --> promotion
    progMember --> token


    %% Gold standard styling with proper color hierarchy
    style activityDef fill:#1976d2,stroke:#fff,stroke-width:4px,color:#fff
    style center fill:#1976d2,stroke:#fff,stroke-width:4px,color:#fff
    style media fill:#1976d2,stroke:#fff,stroke-width:4px,color:#fff
    style partner fill:#1976d2,stroke:#fff,stroke-width:4px,color:#fff
    style programme fill:#1976d2,stroke:#fff,stroke-width:4px,color:#fff
    style progRole fill:#1976d2,stroke:#fff,stroke-width:4px,color:#fff
    style activity fill:#1976d2,stroke:#fff,stroke-width:4px,color:#fff
    style dmFile fill:#1976d2,stroke:#fff,stroke-width:4px,color:#fff
    style guide fill:#1976d2,stroke:#fff,stroke-width:4px,color:#fff
    style member fill:#1976d2,stroke:#fff,stroke-width:4px,color:#fff
    style journalDef fill:#1976d2,stroke:#fff,stroke-width:4px,color:#fff
    style report fill:#1976d2,stroke:#fff,stroke-width:4px,color:#fff
    style tracker fill:#43a047,stroke:#fff,stroke-width:4px,color:#fff
    style trackerDef fill:#43a047,stroke:#fff,stroke-width:4px,color:#fff
    style report fill:#388e3c,stroke:#fff,stroke-width:3px,color:#fff
    style SSQ_arthritis01 fill:#b39ddb,stroke:#7e57c2,stroke-width:2px,color:#222
    style SSQ_pain01 fill:#b39ddb,stroke:#7e57c2,stroke-width:2px,color:#222
    style SSQ_stress01 fill:#b39ddb,stroke:#7e57c2,stroke-width:2px,color:#222
    style dmProfile fill:#42a5f5,stroke:#fff,stroke-width:2px,color:#fff
    style farGroup fill:#42a5f5,stroke:#fff,stroke-width:2px,color:#fff
    style farPermission fill:#42a5f5,stroke:#fff,stroke-width:2px,color:#fff
    style farRole fill:#42a5f5,stroke:#fff,stroke-width:2px,color:#fff
    style farUser fill:#42a5f5,stroke:#fff,stroke-width:2px,color:#fff
    style intake fill:#42a5f5,stroke:#fff,stroke-width:2px,color:#fff
    style memberGroup fill:#42a5f5,stroke:#fff,stroke-width:2px,color:#fff
    style referer fill:#42a5f5,stroke:#fff,stroke-width:2px,color:#fff
    style aCuePointActivities fill:#42a5f5,stroke:#fff,stroke-width:2px,color:#fff
    style aInteract1Activities fill:#42a5f5,stroke:#fff,stroke-width:2px,color:#fff
    style aInteract2Activities fill:#42a5f5,stroke:#fff,stroke-width:2px,color:#fff
    style aInteract3Activities fill:#42a5f5,stroke:#fff,stroke-width:2px,color:#fff
    style aInteract4Activities fill:#42a5f5,stroke:#fff,stroke-width:2px,color:#fff
    style aInteract5Activities fill:#42a5f5,stroke:#fff,stroke-width:2px,color:#fff
    style aMediaIDs fill:#42a5f5,stroke:#fff,stroke-width:2px,color:#fff
    style defaultMediaID fill:#42a5f5,stroke:#fff,stroke-width:2px,color:#fff
    style dmFacts fill:#42a5f5,stroke:#fff,stroke-width:2px,color:#fff
    style dmHTML fill:#42a5f5,stroke:#fff,stroke-width:2px,color:#fff
    style dmImage fill:#42a5f5,stroke:#fff,stroke-width:2px,color:#fff
    style dmInclude fill:#42a5f5,stroke:#fff,stroke-width:2px,color:#fff
    style dmNavigation fill:#42a5f5,stroke:#fff,stroke-width:2px,color:#fff
    style dmNews fill:#42a5f5,stroke:#fff,stroke-width:2px,color:#fff
    style journal fill:#42a5f5,stroke:#fff,stroke-width:2px,color:#fff
    style onEndID fill:#42a5f5,stroke:#fff,stroke-width:2px,color:#fff
    style tracker01 fill:#42a5f5,stroke:#fff,stroke-width:2px,color:#fff
    style tracker02 fill:#42a5f5,stroke:#fff,stroke-width:2px,color:#fff
    style tracker03 fill:#42a5f5,stroke:#fff,stroke-width:2px,color:#fff
    style tracker04 fill:#42a5f5,stroke:#fff,stroke-width:2px,color:#fff
    style tracker05 fill:#42a5f5,stroke:#fff,stroke-width:2px,color:#fff
    style address fill:#9e9e9e,stroke:#fff,stroke-width:1px,color:#fff
    style device fill:#9e9e9e,stroke:#fff,stroke-width:1px,color:#fff
    style JWTapp fill:#9e9e9e,stroke:#fff,stroke-width:1px,color:#fff
    style library fill:#9e9e9e,stroke:#fff,stroke-width:1px,color:#fff
    style memberType fill:#9e9e9e,stroke:#fff,stroke-width:1px,color:#fff
    style oAuth2service fill:#9e9e9e,stroke:#fff,stroke-width:1px,color:#fff
    style promotion fill:#9e9e9e,stroke:#fff,stroke-width:1px,color:#fff
    style token fill:#9e9e9e,stroke:#fff,stroke-width:1px,color:#fff</div>
    </div>

    <div id="paste-reminder">
        Press Ctrl+V to paste your diagram code!
    </div>

    <script>
    function showPasteReminder() {
        const reminder = document.getElementById('paste-reminder');
        reminder.style.display = 'block';
        setTimeout(() => {
            reminder.style.display = 'none';
        }, 5000);
    }

    function openEditorAndCopy() {
        // Get the code from the div instead of using a template string
        const mermaidContent = document.getElementById('mermaidSource').textContent;
        
        console.log('Attempting to copy:', mermaidContent.substring(0, 100) + '...');
        console.log('Full content length:', mermaidContent.length);
        
        // Try modern clipboard API first
        if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(mermaidContent).then(() => {
                console.log('Clipboard API success');
                // Show success message
                const msg = document.getElementById('copySuccess');
                msg.style.display = 'block';
                setTimeout(() => msg.style.display = 'none', 3000);
                
                // Open Mermaid Live Editor in new tab
                window.open('https://mermaid.live/edit', '_blank');
                
                // Show paste reminder
                showPasteReminder();
            }).catch(err => {
                console.error('Clipboard API failed:', err);
                showCopyError();
            });
        } else {
            console.log('Using fallback copy method');
            fallbackCopy();
        }
        
        function fallbackCopy() {
            try {
                const textArea = document.createElement('textarea');
                textArea.value = mermaidContent;
                textArea.style.position = 'fixed';
                textArea.style.left = '-999999px';
                textArea.style.top = '-999999px';
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                const successful = document.execCommand('copy');
                document.body.removeChild(textArea);
                
                if (successful) {
                    console.log('execCommand success');
                    const msg = document.getElementById('copySuccess');
                    msg.style.display = 'block';
                    msg.textContent = '‚úì Code copied! Press Ctrl+V to paste';
                    setTimeout(() => msg.style.display = 'none', 3000);
                    
                    // Open editor with URL parameters
                    const editorUrl = 'https://mermaid.live/edit';
                    
                    // Open Mermaid Live Editor in new tab
                    window.open(editorUrl, '_blank');
                    
                    setTimeout(showPasteReminder, 1000);
                } else {
                    console.log('execCommand failed');
                    showCopyError();
                }
            } catch (err) {
                console.error('execCommand error:', err);
                showCopyError();
            }
        }

        function showCopyError() {
            const msg = document.getElementById('copyError');
            msg.style.display = 'block';
            setTimeout(() => msg.style.display = 'none', 5000);
        }
    }

    function manualCopy() {
        const mermaidContent = document.getElementById('mermaidSource').textContent;
        if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(mermaidContent).then(() => {
                const msg = document.getElementById('copySuccess');
                msg.style.display = 'block';
                msg.textContent = '‚úì Code copied! Press Ctrl+V to paste';
                setTimeout(() => msg.style.display = 'none', 3000);
                console.log('Manual copy successful via Clipboard API');
            }).catch(err => {
                const msg = document.getElementById('copyError');
                msg.style.display = 'block';
                msg.textContent = 'Failed to copy code. Please select and copy manually.';
                setTimeout(() => msg.style.display = 'none', 5000);
                console.error('Manual copy failed via Clipboard API:', err);
            });
        } else {
            try {
                const textArea = document.createElement('textarea');
                textArea.value = mermaidContent;
                textArea.style.position = 'fixed';
                textArea.style.left = '-999999px';
                textArea.style.top = '-999999px';
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                const successful = document.execCommand('copy');
                document.body.removeChild(textArea);
                if (successful) {
                    const msg = document.getElementById('copySuccess');
                    msg.style.display = 'block';
                    msg.textContent = '‚úì Code copied! Press Ctrl+V to paste';
                    setTimeout(() => msg.style.display = 'none', 3000);
                    console.log('Manual copy successful via execCommand');
                } else {
                    const msg = document.getElementById('copyError');
                    msg.style.display = 'block';
                    msg.textContent = 'Failed to copy code. Please select and copy manually.';
                    setTimeout(() => msg.style.display = 'none', 5000);
                    console.log('Manual copy failed via execCommand');
                }
            } catch (err) {
                const msg = document.getElementById('copyError');
                msg.style.display = 'block';
                msg.textContent = 'Failed to copy code. Please select and copy manually.';
                setTimeout(() => msg.style.display = 'none', 5000);
                console.error('Manual copy failed via execCommand:', err);
            }
        }
    }

    function showDebugInfo() {
        const mermaidContent = document.getElementById('mermaidSource').textContent;
        console.log('=== DEBUG INFO ===');
        console.log('Content length:', mermaidContent.length);
        console.log('First 200 chars:', mermaidContent.substring(0, 200));
        console.log('Last 100 chars:', mermaidContent.substring(mermaidContent.length - 100));
        console.log('Contains "erDiagram":', mermaidContent.includes('erDiagram'));
        console.log('Contains "classDiagram":', mermaidContent.includes('classDiagram'));
        console.log('Full content:');
        console.log(mermaidContent);
        
        // Show in an alert for easy viewing
        alert('Content length: ' + mermaidContent.length + '\n\nFirst 200 chars:\n' + mermaidContent.substring(0, 200) + '\n\nContains erDiagram: ' + mermaidContent.includes('erDiagram'));
    }
    </script>
</body>
</html>
